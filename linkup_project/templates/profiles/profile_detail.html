{% extends 'base.html' %}
{% load post_filters %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Profile Header Card -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden mb-6">
        <!-- Cover Image -->
        <div class="h-48 md:h-64 bg-gray-300 relative">
            {% if profile.cover_pic %}
                <img src="{{ profile.cover_pic.url }}" class="w-full h-full object-cover">
            {% else %}
                <div class="w-full h-full bg-gradient-to-r from-blue-400 to-indigo-500"></div>
            {% endif %}
        </div>

        <!-- Profile Info (Pic, Name, Actions) -->
        <div class="relative px-6 pb-6">
            <div class="flex flex-col md:flex-row items-end -mt-12 md:-mt-16 mb-4">
                <!-- Profile Pic -->
                <div class="w-32 h-32 md:w-40 md:h-40 rounded-full border-4 border-white overflow-hidden shadow-lg bg-gray-200 flex-shrink-0 z-10">
                     {% if profile.profile_pic %}
                        <img src="{{ profile.profile_pic.url }}" class="w-full h-full object-cover">
                    {% else %}
                        <div class="w-full h-full bg-gray-200 flex items-center justify-center text-4xl font-bold text-gray-500">
                            {{ profile_user.username.0|upper }}
                        </div>
                    {% endif %}
                </div>

                <!-- Name & Action Button -->
                <div class="flex-1 md:ml-6 mt-4 md:mt-0 flex flex-col md:flex-row justify-between items-start md:items-end w-full">
                    <div class="mb-4 md:mb-0">
                         <h2 class="text-3xl font-bold text-gray-800">{{ profile_user.username }}</h2>
                         {% if profile.location %}
                            <p class="text-gray-500 text-sm flex items-center mt-1">
                                <i class="fas fa-map-marker-alt mr-1"></i> {{ profile.location }}
                            </p>
                         {% endif %}
                    </div>
                    
                    <div class="flex gap-3">
                        {% if request.user == profile_user %}
                            <a href="{% url 'profiles:profile_edit' %}" class="bg-white border border-gray-300 text-gray-700 font-semibold py-2 px-4 rounded hover:bg-gray-50 transition shadow-sm">
                                <i class="fas fa-pen mr-1"></i> Edit Profile
                            </a>
                        {% else %}
                            <form method="POST" action="{% url 'follows:toggle_follow' profile_user.id %}">
                                {% csrf_token %}
                                {% if profile_user|is_following:request.user %}
                                     <button type="submit" class="bg-gray-200 text-gray-800 font-bold py-2 px-6 rounded hover:bg-gray-300 transition">
                                        Unfollow
                                    </button>
                                {% else %}
                                    <button type="submit" class="bg-blue-500 text-white font-bold py-2 px-6 rounded hover:bg-blue-600 transition shadow-md">
                                        Follow
                                    </button>
                                {% endif %}
                            </form>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Bio -->
            {% if profile.bio %}
                <div class="mt-4 text-gray-700 max-w-2xl">
                    <p>{{ profile.bio }}</p>
                </div>
            {% endif %}

            <!-- Stats -->
            <div class="flex gap-6 mt-6 border-t pt-4">
                <div class="flex items-center">
                    <span class="font-bold text-gray-900 text-lg mr-1">{{ profile_user.followers.count }}</span>
                    <span class="text-gray-500">Followers</span>
                </div>
                <div class="flex items-center">
                    <span class="font-bold text-gray-900 text-lg mr-1">{{ profile_user.following.count }}</span>
                    <span class="text-gray-500">Following</span>
                </div>
                <div class="flex items-center">
                    <span class="font-bold text-gray-900 text-lg mr-1">{{ posts.count }}</span> <!-- This assumes posts is a QuerySet for this user -->
                    <span class="text-gray-500">Posts</span>
                </div>
            </div>
        </div>
    </div>

    <!-- User's Posts -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Left Col: About/Photos (Placeholder) or just blank for now to keep it centered feed style? -->
        <!-- Center/Right Col: Feed -->
        <div class="md:col-span-2 md:col-start-1 md:col-end-4 lg:col-span-2 lg:col-start-2">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Posts</h3>
            <div class="space-y-6">
                {% for post in posts %}
                    {% include 'posts/post_item.html' with post=post %}
                {% empty %}
                    <div class="bg-white rounded-lg p-8 text-center shadow-sm">
                        <p class="text-gray-500">No posts shared yet.</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
