{% extends 'base.html' %}

{% block content %}
<div class="flex items-center justify-center min-h-[80vh]">
    <div class="w-full max-w-md bg-white rounded-lg shadow-md p-8">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Sign Up</h2>

        <form method="POST" class="space-y-4">
            {% csrf_token %}
            
            {% if form.non_field_errors %}
                <div class="bg-red-50 text-red-500 text-sm p-3 rounded-md">
                    {{ form.non_field_errors.0 }}
                </div>
            {% endif %}

            {% for field in form %}
            <div>
                <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                    {{ field.label }}
                </label>
                {{ field }}
                {% if field.help_text and field.html_name != 'password1' %}
                    <p class="text-gray-400 text-xs mt-1 flex items-start">
                        <i class="fas fa-info-circle mr-1 mt-0.5"></i> 
                        <span>{{ field.help_text }}</span>
                    </p>
                {% endif %}
                {% if field.errors %}
                    <p class="text-red-500 text-xs mt-1">{{ field.errors.0 }}</p>
                {% endif %}
            </div>
            {% endfor %}

            <!-- Custom Password Requirements -->
            <div class="bg-blue-50 border border-blue-100 rounded-lg p-4">
                <h4 class="text-blue-800 text-xs font-bold uppercase tracking-wide mb-2 flex items-center">
                    <i class="fas fa-shield-alt mr-2"></i> Security Check
                </h4>
                <div class="grid grid-cols-2 gap-2">
                    <div class="flex items-center text-xs text-gray-500 transition" id="rule-length">
                        <i class="far fa-circle mr-2 text-gray-300"></i> 8+ Characters
                    </div>
                    <div class="flex items-center text-xs text-gray-500 transition" id="rule-mixed">
                        <i class="far fa-circle mr-2 text-gray-300"></i> Letters & Numbers
                    </div>
                    <div class="flex items-center text-xs text-gray-500 transition" id="rule-match">
                        <i class="far fa-circle mr-2 text-gray-300"></i> Passwords Match
                    </div>
                </div>
            </div>

            <button type="submit" class="w-full bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-600 transition duration-300">
                Create Account
            </button>
        </form>

        <p class="mt-4 text-center text-sm text-gray-600">
            Already have an account?
            <a href="{% url 'accounts:login' %}" class="text-blue-500 hover:text-blue-700 font-semibold">Login</a>
        </p>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const emailInput = document.getElementById('id_email');
        
        if (emailInput) {
            // Create a JS-specific error message container
            const errorMsg = document.createElement('p');
            errorMsg.classList.add('text-red-500', 'text-xs', 'mt-1', 'hidden');
            errorMsg.innerText = 'Please enter a valid email address.';
            
            // Insert it after the input (or after the wrapper div's content)
            // The structure is <div> <label> <input> <help> <error> </div>
            // We append to the parent div
            emailInput.parentNode.appendChild(errorMsg);

            function validateEmail() {
                const email = emailInput.value;
                // Simple regex for basic format checking
                const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                
                if (email.length > 0 && !regex.test(email)) {
                    errorMsg.classList.remove('hidden');
                } else {
                    errorMsg.classList.add('hidden');
                }
            }

            emailInput.addEventListener('input', validateEmail);
            emailInput.addEventListener('blur', validateEmail);
        }

        // Password Validation
        const pass1 = document.getElementById('id_password1');
        const pass2 = document.getElementById('id_password2');

        const ruleLength = document.getElementById('rule-length');
        const ruleMixed = document.getElementById('rule-mixed');
        const ruleMatch = document.getElementById('rule-match');

        function updateRule(element, isValid) {
            const icon = element.querySelector('i');
            if (isValid) {
                element.classList.remove('text-gray-500');
                element.classList.add('text-green-600', 'font-medium');
                icon.classList.remove('far', 'fa-circle', 'text-gray-300');
                icon.classList.add('fas', 'fa-check-circle', 'text-green-500');
            } else {
                element.classList.add('text-gray-500');
                element.classList.remove('text-green-600', 'font-medium');
                icon.classList.add('far', 'fa-circle', 'text-gray-300');
                icon.classList.remove('fas', 'fa-check-circle', 'text-green-500');
            }
        }

        if (pass1) {
            pass1.addEventListener('input', function() {
                const val = pass1.value;
                updateRule(ruleLength, val.length >= 8);
                updateRule(ruleMixed, /\d/.test(val) && /[a-zA-Z]/.test(val));
                validateMatch();
            });
        }

        if (pass2) {
            pass2.addEventListener('input', validateMatch);
        }

        function validateMatch() {
            if (pass2.value.length > 0) {
                 updateRule(ruleMatch, pass1.value === pass2.value);
            } else {
                 updateRule(ruleMatch, false);
            }
        }
    });
</script>
{% endblock %}
